<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"
    ></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/@picocss/pico@1.*/css/pico.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap"
      rel="stylesheet"
    />
    <title></title>
    <script>
      let loggedUser;
      var rollingId;

      $(document).ready(function () {
        getCookie();
      });

      function rollingStart() {
        var $banner = $(".banner").find("ul");
        var $bannerWidth = $banner.children().outerWidth(); //ë°°ë„ˆ ì´ë¯¸ì§€ì˜ í­
        var $bannerHeight = $banner.children().outerHeight(); // ë†’ì´
        var $bannerLength = $banner.children().length; //ë°°ë„ˆ ì´ë¯¸ì§€ì˜ ê°¯ìˆ˜

        $banner.css("width", $bannerWidth * $bannerLength + "px");
        $banner.css("height", $bannerHeight + "px");
        //alert(bannerHeight);
        //ë°°ë„ˆì˜ ì¢Œì¸¡ ìœ„ì¹˜ë¥¼ ì˜®ê²¨ ì¤€ë‹¤.
        $banner.animate({ left: -$bannerWidth + "px" }, 10, function () {
          //ìˆ«ìëŠ” ë¡¤ë§ ì§„í–‰ë˜ëŠ” ì‹œê°„ì´ë‹¤.
          //ì²«ë²ˆì§¸ ì´ë¯¸ì§€ë¥¼ ë§ˆì§€ë§‰ ëì— ë³µì‚¬(ì´ë™ì´ ì•„ë‹ˆë¼ ë³µì‚¬)í•´ì„œ ì¶”ê°€í•œë‹¤.
          $(this).append("<li>" + $(this).find("li:first").html() + "</li>");
          //ë’¤ë¡œ ë³µì‚¬ëœ ì²«ë²ˆì¬ ì´ë¯¸ì§€ëŠ” í•„ìš” ì—†ìœ¼ë‹ˆ ì‚­ì œí•œë‹¤.
          $(this).find("li:first").remove();
          //ë‹¤ìŒ ì›€ì§ì„ì„ ìœ„í•´ì„œ ë°°ë„ˆ ì¢Œì¸¡ì˜ ìœ„ì¹˜ê°’ì„ ì´ˆê¸°í™” í•œë‹¤.
          $(this).css("left", 0);
          //ì´ ê³¼ì •ì„ ë°˜ë³µí•˜ë©´ì„œ ê³„ì† ë¡¤ë§í•˜ëŠ” ë°°ë„ˆë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
        });
      }

      //ë‹¹ì²¨ì ì„ ì • ë½‘ê¸°ì‹œì— ì‹¤í–‰ëœë‹¤.
      function winnerSelect() {
        var winner = $("li:first").find("h2");
        alert(winner.text() + "ë‹˜ ë‹¹ì²¨ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤~");
        winnerData = winner.text();
        if (winner.text() != null) {
          winnerList(`${winner.text()}`);
          //winnerCongrats(winner.text()); í•¨ìˆ˜ ì½”ë“œ ë©”ëª¨ì¥ì— ìˆì–´
          //ì´ ifë¬¸ì—ì„œ íŒŒì´ì¬ ë””ë¹„ì— ë‹¹ì²¨ìë¦¬ìŠ¤íŠ¸ì— ë‹´ì•„ì£¼ëŠ” ì‘ì—…ì„ í•˜ì
        }
      }
      //ì¶”ì²¨ ì‹œì‘ ë²„íŠ¼ ë³€í™˜ ê¸°ëŠ¥
      function startStop() {
        const btn = document.querySelector("#rolling-box"); //idê°€ 'btn'ì¸ ìš”ì†Œë¥¼ ë°˜í™˜í•œë‹¤.
        if (btn.innerText == "ëŒë¦¬ê¸°") {
          //ë²„íŠ¼ì˜ í…ìŠ¤íŠ¸ê°’ í™•ì¸
          rollingReStart();
          btn.innerText = "ë½‘ê¸°"; // í…ìŠ¤íŠ¸ë¥¼ unfollowë¡œ ë³€ê²½
        } else {
          // ë°˜ëŒ€ì¼ ê²½ìš° ë‹¤ì‹œ ë³€ê²½
          rollingStop();
          btn.innerText = "ëŒë¦¬ê¸°";
        }
      }
      //ì¶”ì²¨ ì¬ì‹œì‘
      function rollingReStart() {
        rollingId = setInterval(function () {
          getUserPhoto();
          rollingStart();
        }, 150);
      }
      //ë½‘ê¸° == ë¡¤ë§ ë©ˆì¶”ê¸°
      function rollingStop() {
        winnerSelect();
        clearInterval(rollingId);
      }

      // ìœ ì € ì‚¬ì§„ ë§í¬,ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
      function getUserPhoto() {
        $.ajax({
          type: "GET",
          url: "/userList",
          data: {},
          success: function (response) {
            let users = response["user"];
            console.log(users);
            for (let i = 0; i < users.length; i++) {
              if (users[i]["name"] != "admin") {
                makePhoto(users[i]["photo"], users[i]["name"]);
              }
            }
          },
        });
      }
      //ë‹¹ì²¨ëœ ì¸ì› ë°›ì•„ì˜¨ ìœ ì € ë¦¬ìŠ¤íŠ¸ì—ì„œ ì‚­ì œí•˜ë©´ì„œ(dbëŠ” ìœ ì§€) ë‹¹ì²¨ì ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€í•˜ëŠ” ê¸°ëŠ¥
      function winnerList(winner) {
        $.ajax({
          type: "POST",
          url: "/winnerList",
          data: { winner_give: winner },
          success: function (response) {},
        });
      }
      //winnerList DB ì „ì²´ ì‚­ì œ
      function deleteAll() {
        $.ajax({
          type: "POST",
          url: "/winner/deleteAll",
          data: {},
          success: function (response) {
            if (response["result"] == "success") {
              alert("ë‹¹ì²¨ì ì „ì²´ ì‚­ì œ");
              window.location.reload();
            } else {
              alert("ì„œë²„ ì˜¤ë¥˜!");
            }
          },
        });
      }
      //ë‹¹ì²¨ëœ ì‚¬ëŒ photoLink ì‚­ì œí•˜ê¸° êµ¬í˜„í•´ì•¼í•¨
      function makePhoto(photoLink, name) {
        let tempHtml = `
  <li class='${name}' style="list-style: none;">
      <img
        src=${photoLink}
        width="200px"
        height="150px"
        />
        <h2>${name}</h2>
      </li>
  `;
        $("#banner").append(tempHtml);
      }
      //ë‹¹ì²¨ëœ ì‚¬ëŒ ì¶•í•˜ë©”ì‹œì§€ ìœ ì§€? ìœ ì§€í•˜ì§€ë§ˆ?
      //ì‚¬ìš©ì ì¿ í‚¤ ê°€ì ¸ì˜¤ê¸°
      function getCookie() {
        let cookie = $.cookie("mytoken");
        $.ajax({
          type: "POST",
          url: "/cookie/get",
          data: { mytoken: cookie },
          success: function (response) {
            loggedUser = response["loggedUser"];
            console.log(loggedUser);
            showToAdmin(loggedUser);
            userName = loggedUser["name"];
            loggedUserName(userName);
            if (userName == "admin") {
              getUserPhoto();
            }
            localStorage.setItem("user-info", JSON.stringify(loggedUser));
          },
        });
      }

      function deletePost(id) {
        $.ajax({
          type: "POST",
          url: "/api/deleteFeed",
          data: { id_give: id },
          success: function (response) {
            if (response["result"] == "success") {
              alert("ì‚­ì œ ì™„ë£Œ!");
              location.reload();
            }
          },
        });
      }

      function showToAdmin(loggedUser) {
        $(".admin").hide();
        if (loggedUser["name"] == "admin" && loggedUser["email"] == "admin") {
          $(".admin").show();
        }
      }

      //ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
      function loggedUserName(userName) {
        let tempHtml = `
        <a role="button" class="outline"
        >${userName}</a>
      `;
        $("#upperStyle").prepend(tempHtml);
      }

      //ë¡œê·¸ì•„ì›ƒ
      function logout() {
        $.removeCookie("mytoken", { path: "/" });
        window.location.href = "/";
      }
    </script>
  </head>

  <style>
    * {
      margin: auto;
      font-family: "Nanum Gothic", sans-serif;
    }

    h2,
    h3,
    h4,
    h5,
    h6 {
      margin: 10px;
      font-family: "Nanum Gothic", sans-serif;
    }

    h1 {
      background-color: hsl(195deg, 85%, 41%);
      border-width: 0;
      border-style: solid;
      border-radius: 5px;
      border-color: black;
      text-align: center;
      color: white;
    }

    .wrapper {
      width: 800px;
      margin: 0 auto;
    }

    th {
      text-align: center;
    }

    .contents {
      width: 600px;
      height: 400px;
      margin: 0 auto;
    }

    .banner {
      position: relative;
      top: 40px;
      left: 150px;
      object-fit: cover;
      width: 500px;
      height: 400px;
      margin: 0 auto;
      padding: 0;
      overflow: hidden;
    }
    .banner ul {
      position: absolute;
      object-fit: cover;
      margin: 0px;
      width: 600px;
      padding: 0;
      list-style: none;
    }
    .banner ul li {
      float: left;
      object-fit: cover;
      width: 500px;
      height: 400px;
      bottom: 100px;
      margin: 0;
      padding: 0;
    }
    ul#winnercard {
      padding: 0;
      text-align: center;
    }
    li#winnercard {
      display: inline-block;
    }
  </style>

  <body>
    <div id="upperStyle">
      <a href="/" id="logout" role="button" class="outline" onclick="logout()"
        >ë¡œê·¸ì•„ì›ƒ</a
      >
    </div>
    <div class="wrapper">
      <h1 display="inline">ì´ë²ˆ ì£¼ ì²­ì†Œë‹¹ë²ˆì€?</h1>
      <main class="container">
        <div class="contents admin">
          <div class="banner">
            <ul id="banner"></ul>
          </div>
        </div>

        <ul id="winnercard">
          {% for winner in winners %}
          <li style="list-style: none">
            <img src="{{winner.photo}}" width="100px" height="100px" />
            <span>{{winner.name}}ë‹˜! ì²­ì†Œë¥¼ ë¶€íƒí•´ìš” ğŸ˜‚</span>
          </li>
          {% endfor %}
        </ul>
        <button type="submit" onclick="location.href='/uploadPage'">
          ì¸ì¦ê¸€ ì“°ëŸ¬ ê°€ê¸°
        </button>
        <div class="container">
          <!-- <img src="{{ url_for('static', filename='pig.PNG') }}" alt=""/> -->
          <div class="grid">
            <button
              class="admin"
              type="submit"
              id="rolling-box"
              onclick="startStop()"
            >
              ëŒë¦¬ê¸°
            </button>

            <button class="admin" type="submit" onclick="deleteAll()">
              ë‹¤ì‹œë½‘ê¸°
            </button>

            <button
              type="submit"
              id="rolling-box"
              onclick="location.href='/userlist'"
            >
              ìœ ì €ë¦¬ìŠ¤íŠ¸
            </button>
          </div>
        </div>
      </main>
      <p></p>
      <table>
        <thead>
          <tr>
            <th scope="col" width="1000px">ì´ë²ˆì£¼ ì²­ì†Œ ì¸ì¦!</th>
            <th scope="col" class="admin">ğŸ¤”</th>
          </tr>
        </thead>
        {% for data in datas %}
        <tbody>
          <tr>
            <td><a href="/detail/{{data._id}}">{{data.title}}</a></td>
            {% if ((data['email'] == 'admin') and (data['name'] == 'admin')) %}
            <td></td>
            {% else %}
            <td onclick="deletePost(`{{ data['_id'] }}`)" class="admin">âŒ</td>
            {% endif %}
            <td></td>
          </tr>
        </tbody>
        {% endfor%}
      </table>
    </div>
  </body>
</html>
